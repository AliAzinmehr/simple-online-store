<!--index.html-->
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø¢Ù†Ù„Ø§ÛŒÙ† | SIMPLE SHOP</title>

  <!-- Bootstrap 5 + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <!-- Google Fonts: Vazirmatn + Yekan Bakh -->
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&family=Yekan+Bakh:wght@400;600;800&display=swap" rel="stylesheet" />

  <style>
    :root {
      --primary: #2c3e50;
      --primary-light: #34495e;
      --accent: #3498db;
      --accent-light: #5dade2;
      --success: #27ae60;
      --danger: #e74c3c;
      --light: #ecf0f1;
      --lighter: #f8f9fa;
      --dark: #2c3e50;
      --gray: #95a5a6;
      --border: #bdc3c7;
    }

    * { font-family: 'Vazirmatn', 'Yekan Bakh', Tahoma, sans-serif; }

    body {
      background: #f8f9fa;
      padding: 0;
      margin: 0;
      color: var(--dark);
    }

    .navbar {
      background: white;
      border-bottom: 2px solid var(--light);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      padding: 1rem 0;
    }

    .navbar-brand {
      font-weight: 800;
      font-size: 1.5rem;
      color: var(--primary);
      letter-spacing: -0.5px;
    }

    .nav-link {
      font-weight: 500;
      color: var(--dark);
      transition: all 0.3s;
      margin: 0 0.5rem;
    }

    .nav-link:hover {
      color: var(--accent);
    }

    .sidebar {
      min-width: 260px;
      max-width: 260px;
      background: white;
      border-left: 1px solid var(--light);
      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.05);
      height: 100vh;
      position: sticky;
      top: 0;
      padding-top: 2rem;
    }

    .sidebar .nav-link {
      border-radius: 0.5rem;
      margin: 8px 12px;
      padding: 12px 15px;
      color: var(--dark);
      font-size: 0.95rem;
      transition: all 0.3s;
    }

    .sidebar .nav-link.active {
      background: var(--accent);
      color: white;
    }

    .sidebar .nav-link:hover:not(.active) {
      background: var(--light);
      color: var(--accent);
    }

    .content {
      flex: 1;
      padding: 2rem;
      background: #f8f9fa;
    }

    .hero {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: white;
      padding: 4rem 2rem;
      border-radius: 1rem;
      margin-bottom: 3rem;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .product-card {
      border: 1px solid var(--light);
      border-radius: 0.75rem;
      transition: all 0.3s ease;
      background: white;
      overflow: hidden;
    }

    .product-card:hover {
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
      transform: translateY(-4px);
      border-color: var(--accent);
    }

    .product-img {
      width: 100%;
      height: 250px;
      object-fit: cover;
      background: var(--light);
      transition: transform 0.3s;
    }

    .product-card:hover .product-img {
      transform: scale(1.05);
    }

    .stat-card {
      background: white;
      border: 1px solid var(--light);
      border-radius: 0.75rem;
      padding: 1.5rem;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .stat-card h6 {
      color: var(--gray);
      font-size: 0.85rem;
      font-weight: 600;
    }

    .stat-card h3 {
      color: var(--primary);
      font-weight: 700;
      margin-top: 0.5rem;
    }

    .cart-floating {
      position: fixed;
      bottom: 30px;
      left: 30px;
      width: 60px;
      height: 60px;
      background: var(--accent);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4);
      transition: all 0.3s;
      color: white;
    }

    .cart-floating:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(52, 152, 219, 0.5);
    }

    .cart-badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background: var(--danger);
      color: white;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.75rem;
    }

    .table {
      background: white;
      border-collapse: collapse;
    }

    .table tbody tr {
      border-bottom: 1px solid var(--light);
    }

    .table tbody tr:hover {
      background: var(--lighter);
    }

    .btn-primary {
      background: var(--accent);
      border: none;
      border-radius: 0.5rem;
      font-weight: 600;
      transition: all 0.3s;
    }

    .btn-primary:hover {
      background: var(--primary);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
    }

    .modal-content {
      border: 1px solid var(--light);
      border-radius: 0.75rem;
      box-shadow: 0 5px 30px rgba(0, 0, 0, 0.15);
    }

    .form-control {
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      padding: 0.75rem 1rem;
      transition: all 0.3s;
    }

    .form-control:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }

    #productDetailView {
      background: white;
      border-radius: 1rem;
      padding: 2rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .product-detail-card {
      background: white;
      border-radius: 0.75rem;
      overflow: hidden;
    }

    .product-detail-img {
      width: 100%;
      height: 400px;
      object-fit: cover;
      background: var(--light);
    }

    .product-detail-info h2 {
      color: var(--primary);
      font-weight: 700;
      margin-top: 1.5rem;
    }

    .product-detail-category {
      display: inline-block;
      background: var(--light);
      color: var(--primary);
      padding: 0.4rem 0.8rem;
      border-radius: 2rem;
      font-size: 0.85rem;
      font-weight: 600;
      margin-bottom: 1rem;
    }

    .product-detail-description {
      color: var(--gray);
      line-height: 1.6;
      margin: 1rem 0;
      padding: 1rem;
      background: var(--lighter);
      border-radius: 0.5rem;
      border-left: 3px solid var(--accent);
    }

    .product-detail-price-section {
      background: var(--lighter);
      padding: 1.5rem;
      border-radius: 0.5rem;
      margin: 1.5rem 0;
    }

    .product-detail-price {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--accent);
    }

    .product-detail-stock {
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }

    .product-detail-buttons {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .product-detail-buttons .btn {
      flex: 1;
      padding: 0.75rem;
      font-weight: 600;
      border-radius: 0.5rem;
    }

    .offcanvas {
      background: white;
      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.1);
    }

    #cartView {
      background: white;
      border-radius: 1rem;
      padding: 2rem;
    }

    .cart-page-container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .cart-page-header {
      border-bottom: 2px solid var(--light);
      padding-bottom: 1.5rem;
      margin-bottom: 2rem;
    }

    .cart-page-header h2 {
      color: var(--primary);
      font-weight: 700;
      margin: 0;
    }

    .cart-items-table {
      width: 100%;
      background: white;
    }

    .cart-items-table thead {
      background: var(--light);
      border-bottom: 2px solid var(--border);
    }

    .cart-items-table th {
      padding: 1rem;
      text-align: right;
      font-weight: 700;
      color: var(--primary);
    }

    .cart-items-table td {
      padding: 1rem;
      border-bottom: 1px solid var(--light);
      vertical-align: middle;
    }

    .cart-product-info {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .cart-product-img {
      width: 80px;
      height: 80px;
      border-radius: 0.5rem;
      object-fit: cover;
      background: var(--light);
    }

    .cart-product-name {
      font-weight: 600;
      color: var(--primary);
    }

    .cart-product-category {
      font-size: 0.85rem;
      color: var(--gray);
    }

    .cart-qty-control {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      padding: 0.25rem;
    }

    .cart-qty-btn {
      background: transparent;
      border: none;
      color: var(--accent);
      width: 28px;
      height: 28px;
      cursor: pointer;
      font-weight: 700;
      transition: all 0.3s;
    }

    .cart-qty-btn:hover {
      background: var(--light);
    }

    .cart-qty-input {
      width: 40px;
      border: none;
      text-align: center;
      font-weight: 600;
    }

    .cart-qty-input:focus {
      outline: none;
    }

    .cart-price {
      font-weight: 700;
      color: var(--accent);
      min-width: 100px;
    }

    .cart-btn-remove {
      background: transparent;
      border: 1px solid var(--danger);
      color: var(--danger);
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }

    .cart-btn-remove:hover {
      background: var(--danger);
      color: white;
    }

    .cart-summary-section {
      background: var(--lighter);
      border-radius: 0.75rem;
      padding: 1.5rem;
      margin-top: 2rem;
    }

    .cart-summary-row {
      display: flex;
      justify-content: space-between;
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--light);
    }

    .cart-summary-row.total {
      border-bottom: none;
      padding-top: 1rem;
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--accent);
    }

    .cart-empty-message {
      text-align: center;
      padding: 3rem 1rem;
    }

    .cart-empty-icon {
      font-size: 4rem;
      color: var(--border);
      margin-bottom: 1rem;
    }

    .cart-empty-text {
      color: var(--gray);
      font-size: 1.1rem;
    }

    .cart-actions {
      display: flex;
      gap: 1rem;
      margin-top: 2rem;
    }

    .cart-actions .btn {
      flex: 1;
      padding: 1rem;
      font-weight: 600;
      border-radius: 0.5rem;
      border: none;
      cursor: pointer;
      transition: all 0.3s;
    }

    /* Order Form Styles */
    .order-form-section {
      background: white;
      border: 1px solid var(--light);
      border-radius: 0.75rem;
      padding: 2rem;
      margin: 2rem 0;
    }

    .order-form-title {
      color: var(--primary);
      font-weight: 700;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid var(--light);
    }

    .order-form .form-label {
      color: var(--primary);
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .order-form .form-control,
    .order-form .form-select {
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      padding: 0.75rem 1rem;
    }

    .order-form .form-control:focus,
    .order-form .form-select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }

    .order-form .form-check-label {
      color: var(--dark);
      font-weight: 500;
    }

    .order-form .form-check-input:checked {
      background-color: var(--accent);
      border-color: var(--accent);
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .modal-dialog-scrollable .modal-body {
      max-height: 70vh;
      overflow-y: auto;
    }

    @media (max-width: 992px) {
      .sidebar { display: none; }
      .content { padding: 1rem; }
    }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">ğŸ›’ SIMPLE SHOP</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto align-items-center">
          <li class="nav-item"><a class="nav-link active" href="#" id="navHome">Ø®Ø§Ù†Ù‡</a></li>
          <li class="nav-item"><a class="nav-link" href="#" id="navProductsLink">Ù…Ø­ØµÙˆÙ„Ø§Øª</a></li>
          <li class="nav-item d-none" id="navOrdersNav"><a class="nav-link" href="#" id="navOrders">Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§</a></li>
          <li class="nav-item"><a class="nav-link" href="#" id="navCart"><i class="bi bi-bag-fill me-2"></i>Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</a></li>
          <li class="nav-item d-none" id="guestLoginNav"><a class="nav-link" href="login.html" id="navLogin"><i class="bi bi-box-arrow-in-right me-2"></i>Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… / ÙˆØ±ÙˆØ¯</a></li>
          <li class="nav-item dropdown d-none" id="userDropdownNav">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
              <span id="welcomeUser"></span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><a class="dropdown-item" href="#" id="logoutBtn">Ø®Ø±ÙˆØ¬</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="d-flex">
    <!-- Sidebar (Admin) -->
    <div class="sidebar d-none" id="adminSidebar">
      <div class="p-4">
        <h6 class="text-muted">Ù…Ø¯ÛŒØ±ÛŒØª</h6>
        <ul class="nav nav-pills flex-column mt-3">
          <li class="nav-item mb-2"><a class="nav-link active" href="#" id="navDashboard"><i class="bi bi-speedometer2 me-2"></i> Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</a></li>
          <li class="nav-item mb-2"><a class="nav-link" href="#" id="navAdminProducts"><i class="bi bi-box-seam me-2"></i> Ù…Ø­ØµÙˆÙ„Ø§Øª</a></li>
          <li class="nav-item mb-2"><a class="nav-link" href="#" id="navAdminOrders"><i class="bi bi-cart-check me-2"></i> Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§</a></li>
        </ul>
      </div>
    </div>

    <!-- Main Content -->
    <div class="content">
      <!-- Hero (Customer) -->
      <div class="hero d-none" id="heroSection">
        <h1 class="display-5 fw-bold">Ø¨Ù‡ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ù…Ø§ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!</h1>
        <p class="lead">Ø¨Ù‡ØªØ±ÛŒÙ† Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¨Ø§ Ø¨Ù‡ØªØ±ÛŒÙ† Ù‚ÛŒÙ…Øª</p>
        <button class="btn btn-primary" id="shopNowBtn">Ø´Ø±ÙˆØ¹ Ø®Ø±ÛŒØ¯</button>
      </div>

      <!-- Customer Products -->
      <div id="customerView">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h3>Ù…Ø­ØµÙˆÙ„Ø§Øª</h3>
          <input type="text" class="form-control w-auto" placeholder="Ø¬Ø³ØªØ¬Ùˆ..." id="searchInput">
        </div>
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4" id="productsContainer"></div>
      </div>

      <!-- Admin Dashboard -->
      <div id="adminView" class="d-none">
        <div class="row mb-4" id="statsRow"></div>
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5>Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø­ØµÙˆÙ„Ø§Øª</h5>
          <div>
            <button class="btn btn-primary me-2" id="openAddProduct"><i class="bi bi-plus-lg"></i> Ø§ÙØ²ÙˆØ¯Ù†</button>
            <button class="btn btn-outline-secondary" id="refreshProducts"><i class="bi bi-arrow-clockwise"></i></button>
          </div>
        </div>
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-primary">
              <tr>
                <th>#</th><th>ØªØµÙˆÛŒØ±</th><th>Ù†Ø§Ù…</th><th>Ù‚ÛŒÙ…Øª</th><th>Ù…ÙˆØ¬ÙˆØ¯ÛŒ</th><th>Ø¯Ø³ØªÙ‡</th><th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
              </tr>
            </thead>
            <tbody id="productsTbody"></tbody>
          </table>
        </div>

        <!-- Admin Orders Section -->
        <hr class="my-5">
        <div>
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5>ğŸ“‹ Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§</h5>
            <button class="btn btn-outline-secondary" id="refreshOrders"><i class="bi bi-arrow-clockwise"></i></button>
          </div>
          <div class="table-responsive">
            <table class="table table-hover align-middle">
              <thead class="table-info">
                <tr>
                  <th>#</th><th>Ù…Ø´ØªØ±ÛŒ</th><th>Ø§ÛŒÙ…ÛŒÙ„</th><th>ØªÙ„ÙÙ†</th><th>Ú©Ù„</th><th>ÙˆØ¶Ø¹ÛŒØª</th><th>ØªØ§Ø±ÛŒØ®</th><th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                </tr>
              </thead>
              <tbody id="ordersTbody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Floating Cart -->
  <div class="cart-floating d-none" id="cartFloating" data-bs-toggle="offcanvas" data-bs-target="#cartOffcanvas">
    <i class="bi bi-cart3 fs-4"></i>
    <span class="badge bg-danger rounded-pill cart-badge" id="cartCount">0</span>
  </div>

  <!-- Cart Offcanvas -->
  <div class="offcanvas offcanvas-end" tabindex="-1" id="cartOffcanvas">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title">Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body" id="cartItems">
      <p class="text-muted">Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø´Ù…Ø§ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.</p>
    </div>
    <div class="offcanvas-footer p-3 border-top d-none" id="cartFooter">
      <div class="d-flex justify-content-between mb-2">
        <strong>Ø¬Ù…Ø¹ Ú©Ù„:</strong>
        <strong id="cartTotal">Û° ØªÙˆÙ…Ø§Ù†</strong>
      </div>
      <button class="btn btn-success w-100" id="checkoutBtn">Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´</button>
    </div>
  </div>

  

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const token = localStorage.getItem('token');
    const role = localStorage.getItem('role') || 'guest';
    const userName = localStorage.getItem('userName') || 'Ù…Ù‡Ù…Ø§Ù†';
    let cart = JSON.parse(localStorage.getItem('cart') || '[]');

    // Elements
    const welcomeUser = document.getElementById('welcomeUser');
    const adminView = document.getElementById('adminView');
    const customerView = document.getElementById('customerView');
    const adminSidebar = document.getElementById('adminSidebar');
    const heroSection = document.getElementById('heroSection');
    const productsContainer = document.getElementById('productsContainer');
    const productsTbody = document.getElementById('productsTbody');
    const statsRow = document.getElementById('statsRow');
    const cartFloating = document.getElementById('cartFloating');
    const cartCount = document.getElementById('cartCount');
    const cartItems = document.getElementById('cartItems');
    const cartFooter = document.getElementById('cartFooter');
    const cartTotal = document.getElementById('cartTotal');

    welcomeUser.innerText = userName;

    // Redirect to login only if trying to access admin features
    if (role === 'admin' && !token) {
      location.href = 'login.html';
    }

    // Show/hide login and user dropdown based on role
    const guestLoginNav = document.getElementById('guestLoginNav');
    const userDropdownNav = document.getElementById('userDropdownNav');
    if (role === 'guest') {
      guestLoginNav.classList.remove('d-none');
      userDropdownNav.classList.add('d-none');
    } else {
      guestLoginNav.classList.add('d-none');
      userDropdownNav.classList.remove('d-none');
    }

    // API Helper with optional token
    const api = (path, opts = {}) => {
      opts.headers = opts.headers || {};
      opts.headers['Content-Type'] = 'application/json';
      if (token) {
        opts.headers['Authorization'] = 'Bearer ' + token;
      }
      return fetch(path, opts).then(r => r.json().then(d => ({ ok: r.ok, data: d })).catch(() => ({ ok: false })));
    };

    // Logout
    document.getElementById('logoutBtn').onclick = async () => {
      try { await fetch('/api/logout', { method: 'POST', headers: { 'Authorization': 'Bearer ' + token } }); } catch {}
      localStorage.clear();
      location.href = 'login.html';
    };

    // Role-based UI
    if (role === 'admin') {
      adminSidebar.classList.remove('d-none');
      adminView.classList.remove('d-none');
      customerView.classList.add('d-none');
      document.getElementById('navOrdersNav').classList.remove('d-none');
      loadAdminDashboard();
    } else if (role === 'customer') {
      heroSection.classList.remove('d-none');
      cartFloating.classList.remove('d-none');
      document.getElementById('navOrdersNav').classList.remove('d-none');
      loadCustomerProducts();
      updateCart();
    } else {
      // Guest role - can view products but cannot checkout without login
      heroSection.classList.remove('d-none');
      cartFloating.classList.remove('d-none');
      document.getElementById('navOrdersNav').classList.add('d-none');
      loadCustomerProducts();
      updateCart();
    }

    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ù† Ø¯Ø± <script>
document.getElementById('navOrders').onclick = async () => {
  const res = await api('/api/dashboard');
  if (res.ok && res.data.role === 'customer') {
    showCustomerOrders(res.data.orders);
  }
};

function showCustomerOrders(orders) {
  customerView.innerHTML = `
    <h3 class="mb-4">Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§</h3>
    ${orders.length ? `
      <div class="table-responsive">
        <table class="table table-hover">
          <thead><tr><th>#</th><th>ØªØ§Ø±ÛŒØ®</th><th>Ù…Ø¨Ù„Øº</th><th>ÙˆØ¶Ø¹ÛŒØª</th></tr></thead>
          <tbody>
            ${orders.map(o => `
              <tr>
                <td>${o.id}</td>
                <td>${new Date(o.order_date).toLocaleDateString('fa-IR')}</td>
                <td>${o.total_price.toLocaleString()} ØªÙˆÙ…Ø§Ù†</td>
                <td><span class="badge bg-${o.status === 'completed' ? 'success' : 'warning'}">${o.status || 'Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´'}</span></td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      </div>
    ` : '<p class="text-muted">Ø³ÙØ§Ø±Ø´ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>'}
  `;
}

    // Load Customer Products
    async function loadCustomerProducts() {
      const res = await api('/api/products');
      if (res.ok) renderCustomerProducts(res.data);
    }

    function renderCustomerProducts(products) {
  const container = document.getElementById('productsContainer');
  container.innerHTML = '';

  products.forEach(p => {
    const col = document.createElement('div');
    col.className = 'col';

    col.innerHTML = `
      <div class="card product-card h-100">
        <img src="${p.image_url || 'https://via.placeholder.com/300'}" class="product-img" alt="${p.name}">
        <div class="card-body d-flex flex-column">
          <h5 class="card-title">${p.name}</h5>
          <p class="text-muted small">${p.category || 'Ø¨Ø¯ÙˆÙ† Ø¯Ø³ØªÙ‡'}</p>
          <div class="mt-auto">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <strong class="text-primary fs-5">${Number(p.price).toLocaleString()} ØªÙˆÙ…Ø§Ù†</strong>
              <span class="badge ${p.stock>0 ? 'bg-success' : 'bg-danger'} fs-6">
                ${p.stock > 0 ? p.stock + ' Ù…ÙˆØ¬ÙˆØ¯' : 'Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯'}
              </span>
            </div>
            <button class="btn btn-primary w-100">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª</button>
          </div>
        </div>
      </div>`;

    // Ø§ÛŒÙ† Ø¯Ùˆ Ø®Ø· Ù…Ù‡Ù… Ù‡Ø³ØªÙ† â€” Ø¬Ù„Ø³Ù‡ Û¶
    col.style.cursor = 'pointer';                    // Ù…ÙˆØ³ Ø¯Ø³Øª Ù…ÛŒØ´Ù‡
    col.onclick = () => showProductDetail(p.id);     // Ú©Ù„ÛŒÚ© â†’ Ø¬Ø²Ø¦ÛŒØ§Øª

    container.appendChild(col);
  });
}

      document.querySelectorAll('.btn-add-cart').forEach(btn => {
        btn.onclick = () => addToCart(btn.dataset.id);
      });
    

    // Cart Functions
    function addToCart(productId, name, price, img) {
      // If called with full product data from detail page
      if (name && price && img) {
        const existing = cart.find(i => i.id == productId);
        if (existing) {
          existing.qty += 1;
        } else {
          cart.push({ id: productId, name, price, img, qty: 1 });
        }
      } else {
        // Fallback: Get from DOM if available
        const product = productsContainer.querySelector(`.btn-add-cart[data-id="${productId}"]`);
        if (!product) return showAlert('Ù…Ø­ØµÙˆÙ„ ÛŒØ§ÙØª Ù†Ø´Ø¯', 'danger');
        const productCard = product.closest('.col');
        const productName = productCard.querySelector('.card-title').innerText;
        const productPrice = parseInt(productCard.querySelector('.text-primary').innerText.replace(/[^0-9]/g, ''));
        const productImg = productCard.querySelector('img').src;
        
        const existing = cart.find(i => i.id == productId);
        if (existing) {
          existing.qty += 1;
        } else {
          cart.push({ id: productId, name: productName, price: productPrice, img: productImg, qty: 1 });
        }
      }
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCart();
    }

    function updateCart() {
      cartCount.innerText = cart.reduce((s, i) => s + i.qty, 0);
      renderCartItems();
    }

    function renderCartItems() {
      if (cart.length === 0) {
        cartItems.innerHTML = '<p class="text-muted">Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø´Ù…Ø§ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.</p>';
        cartFooter.classList.add('d-none');
        return;
      }
      cartItems.innerHTML = '';
      let total = 0;
      cart.forEach((item, idx) => {
        total += item.price * item.qty;
        const div = document.createElement('div');
        div.className = 'd-flex align-items-center mb-3 pb-3 border-bottom';
        div.innerHTML = `
          <img src="${item.img}" class="rounded me-3" style="width:60px;height:60px;object-fit:cover;">
          <div class="flex-grow-1">
            <h6 class="mb-1">${item.name}</h6>
            <small class="text-muted">${item.price.toLocaleString()} ØªÙˆÙ…Ø§Ù† Ã— ${item.qty}</small>
          </div>
          <button class="btn btn-sm btn-danger btn-remove-cart" data-idx="${idx}">Ø­Ø°Ù</button>`;
        cartItems.appendChild(div);
      });
      cartTotal.innerText = total.toLocaleString() + ' ØªÙˆÙ…Ø§Ù†';
      cartFooter.classList.remove('d-none');

      document.querySelectorAll('.btn-remove-cart').forEach(b => {
        b.onclick = () => {
          cart.splice(b.dataset.idx, 1);
          localStorage.setItem('cart', JSON.stringify(cart));
          updateCart();
        };
      });
    }

    document.getElementById('checkoutBtn').onclick = async () => {
      if (cart.length === 0) return;
      
      // Check if user is authenticated
      if (!token || role === 'guest') {
        showAlert('Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ø¨Ø§ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯ ÛŒØ§ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ù†ÛŒØ¯', 'warning');
        setTimeout(() => location.href = 'login.html', 1500);
        return;
      }
      
      const res = await api('/api/orders', {
        method: 'POST',
        body: JSON.stringify({ items: cart })
      });
      if (res.ok) {
        showAlert('Ø³ÙØ§Ø±Ø´ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯!', 'success');
        localStorage.removeItem('cart');
        cart = [];
        updateCart();
      } else {
        showAlert(res.data?.message || 'Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´', 'danger');
      }
    };

    // Admin Dashboard
    async function loadAdminDashboard() {
      const res = await api('/api/dashboard');
      if (res.ok) {
        renderStats(res.data.stats);
        renderAdminProducts(res.data.products || []);
      }
      await loadAdminOrders();
    }

    async function loadAdminOrders() {
      const res = await api('/api/admin/orders');
      if (res.ok) {
        renderAdminOrders(res.data || []);
      }
    }

    function renderAdminOrders(orders) {
      const ordersTbody = document.getElementById('ordersTbody');
      if (!ordersTbody) return;

      ordersTbody.innerHTML = '';
      if (!orders.length) {
        ordersTbody.innerHTML = '<tr><td colspan="8" class="text-center py-4">Ø³ÙØ§Ø±Ø´ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</td></tr>';
        return;
      }

      orders.forEach(o => {
        const tr = document.createElement('tr');
        const statusBadgeClass = {
          'pending': 'warning',
          'paid': 'info',
          'shipped': 'primary',
          'completed': 'success',
          'cancelled': 'danger'
        };
        const statusMap = {
          'pending': 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±',
          'paid': 'Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡',
          'shipped': 'Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡',
          'completed': 'ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡',
          'cancelled': 'Ù„ØºÙˆ Ø´Ø¯Ù‡'
        };

        const orderDate = new Date(o.order_date).toLocaleDateString('fa-IR');

        tr.innerHTML = `
          <td><strong>${o.id}</strong></td>
          <td>${o.customer_name}</td>
          <td>${o.customer_email}</td>
          <td>${o.customer_phone || '-'}</td>
          <td>${Number(o.total_price).toLocaleString()} ØªÙˆÙ…Ø§Ù†</td>
          <td>
            <select class="form-select form-select-sm" data-id="${o.id}" onchange="updateOrderStatus(${o.id}, this.value)">
              <option value="pending" ${o.status === 'pending' ? 'selected' : ''}>Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</option>
              <option value="paid" ${o.status === 'paid' ? 'selected' : ''}>Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡</option>
              <option value="shipped" ${o.status === 'shipped' ? 'selected' : ''}>Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡</option>
              <option value="completed" ${o.status === 'completed' ? 'selected' : ''}>ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡</option>
              <option value="cancelled" ${o.status === 'cancelled' ? 'selected' : ''}>Ù„ØºÙˆ Ø´Ø¯Ù‡</option>
            </select>
          </td>
          <td>${orderDate}</td>
          <td>
            <button class="btn btn-sm btn-info" onclick="showOrderDetails('${o.id}', '${o.customer_name}', '${o.shipping_address}', '${o.payment_method}', '${o.items}')">
              Ø¬Ø²Ø¦ÛŒØ§Øª
            </button>
          </td>
        `;
        ordersTbody.appendChild(tr);
      });
    }

    async function updateOrderStatus(orderId, status) {
      const res = await api(`/api/admin/orders/${orderId}/status`, {
        method: 'PUT',
        body: JSON.stringify({ status })
      });

      if (res.ok) {
        showAlert('ÙˆØ¶Ø¹ÛŒØª Ø³ÙØ§Ø±Ø´ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯', 'success');
        await loadAdminOrders();
      } else {
        showAlert('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª', 'danger');
      }
    }

    function showOrderDetails(id, customerName, address, method, items) {
      const details = `
        <h5>Ø³ÙØ§Ø±Ø´ #${id}</h5>
        <p><strong>Ù…Ø´ØªØ±ÛŒ:</strong> ${customerName}</p>
        <p><strong>Ø¢Ø¯Ø±Ø³:</strong> ${address}</p>
        <p><strong>Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª:</strong> ${method}</p>
        <p><strong>Ù…Ø­ØµÙˆÙ„Ø§Øª:</strong></p>
        <p style="direction: ltr; text-align: left; word-break: break-all; font-size: 0.85rem;">${items}</p>
      `;
      showAlert(details, 'info');
    }


    function renderStats(stats) {
      statsRow.innerHTML = `
        <div class="col-md-4 mb-3">
          <div class="stat-card">
            <div class="d-flex align-items-center">
              <i class="bi bi-box-seam text-primary fs-2 me-3"></i>
              <div>
                <h6 class="text-muted">Ù…Ø­ØµÙˆÙ„Ø§Øª</h6>
                <h3 class="mb-0">${stats.productCount || 0}</h3>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-4 mb-3">
          <div class="stat-card">
            <div class="d-flex align-items-center">
              <i class="bi bi-cart-check text-success fs-2 me-3"></i>
              <div>
                <h6 class="text-muted">Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§</h6>
                <h3 class="mb-0">${stats.orderCount || 0}</h3>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-4 mb-3">
          <div class="stat-card">
            <div class="d-flex align-items-center">
              <i class="bi bi-currency-exchange text-warning fs-2 me-3"></i>
              <div>
                <h6 class="text-muted">Ø¯Ø±Ø¢Ù…Ø¯ Ú©Ù„</h6>
                <h3 class="mb-0">${(stats.totalRevenue || 0).toLocaleString()} ØªÙˆÙ…Ø§Ù†</h3>
              </div>
            </div>
          </div>
        </div>`;
    }

    function renderAdminProducts(list) {
      productsTbody.innerHTML = '';
      if (!list.length) {
        productsTbody.innerHTML = '<tr><td colspan="7" class="text-center py-4">Ù…Ø­ØµÙˆÙ„ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</td></tr>';
        return;
      }
      list.forEach(p => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${p.id}</td>
          <td><img src="${p.image_url || 'https://via.placeholder.com/50'}" class="rounded" style="width:50px;height:50px;object-fit:cover;"></td>
          <td>${p.name}</td>
          <td>${p.price.toLocaleString()}</td>
          <td><span class="badge ${p.stock > 0 ? 'bg-success' : 'bg-danger'}">${p.stock}</span></td>
          <td>${p.category || '-'}</td>
          <td>
            <button class="btn btn-sm btn-danger btn-delete" data-id="${p.id}">Ø­Ø°Ù</button>
          </td>`;
        productsTbody.appendChild(tr);
      });

      document.querySelectorAll('.btn-delete').forEach(b => {
        b.onclick = async () => {
          if (!confirm('Ø­Ø°Ù Ø´ÙˆØ¯ØŸ')) return;
          const res = await fetch('/api/admin/products/' + b.dataset.id, {
            method: 'DELETE',
            headers: { 'Authorization': 'Bearer ' + token }
          });
          if (res.ok) {
            showAlert('Ù…Ø­ØµÙˆÙ„ Ø­Ø°Ù Ø´Ø¯', 'success');
            location.reload();
          } else {
            showAlert('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù', 'danger');
          }
        };
      });
    }

    // Refresh Orders Button
    const refreshOrdersBtn = document.getElementById('refreshOrders');
    if (refreshOrdersBtn) {
      refreshOrdersBtn.onclick = loadAdminOrders;
    }

    // Navigation
    document.getElementById('navHome').onclick = () => location.reload();
    document.getElementById('navProductsLink').onclick = (e) => {
      e.preventDefault();
      document.getElementById('cartView').classList.add('d-none');
      document.getElementById('productDetailView').classList.add('d-none');
      document.getElementById('customerView').classList.remove('d-none');
      loadCustomerProducts();
    };
    document.getElementById('shopNowBtn').onclick = () => window.scrollTo(0, document.getElementById('customerView').offsetTop);
    document.getElementById('refreshProducts').onclick = () => location.reload();

    // Alert Function
    function showAlert(message, type) {
      const alertDiv = document.createElement('div');
      alertDiv.className = `alert alert-${type} alert-dismissible fade show fixed-top mx-auto mt-3`;
      alertDiv.style.maxWidth = '400px';
      alertDiv.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      `;
      document.body.appendChild(alertDiv);
      setTimeout(() => alertDiv.remove(), 3000);
    }

    

  </script>

  <!-- Modal: Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„ (Ø¨Ù‡â€ŒØ±ÙˆØ²Ø´Ø¯Ù‡ Ø¨Ø§ Ø¢Ù¾Ù„ÙˆØ¯ Ø¹Ú©Ø³ Ùˆ Ù…Ø´Ø®ØµØ§Øª) -->
<div class="modal fade" id="addProductModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-scrollable modal-lg">
    <div class="modal-content">
      <form id="addProductForm" enctype="multipart/form-data">
        <div class="modal-header">
          <h5 class="modal-title">Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <!-- Basic Info -->
          <div class="mb-3">
            <label class="form-label">Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„ *</label>
            <input type="text" id="p_name" class="form-control" required />
          </div>
          
          <div class="mb-3">
            <label class="form-label">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ *</label>
            <select id="p_category" class="form-select" required onchange="updateSpecifications()">
              <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option>
              <option value="laptop">Ù„Ù¾â€ŒØªØ§Ù¾</option>
              <option value="mobile">Ù…ÙˆØ¨Ø§ÛŒÙ„</option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label">ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
            <textarea id="p_description" class="form-control" rows="3"></textarea>
          </div>
          
          <div class="mb-3">
            <label class="form-label">Ù‚ÛŒÙ…Øª (ØªÙˆÙ…Ø§Ù†) *</label>
            <input type="number" id="p_price" class="form-control" required />
          </div>
          
          <div class="mb-3">
            <label class="form-label">Ù…ÙˆØ¬ÙˆØ¯ÛŒ</label>
            <input type="number" id="p_stock" class="form-control" value="1" />
          </div>
          
          <div class="mb-3">
            <label class="form-label">Ø¹Ú©Ø³ Ù…Ø­ØµÙˆÙ„</label>
            <input type="file" id="p_image" class="form-control" accept="image/*" />
            <div class="form-text">Ø­Ø¯Ø§Ú©Ø«Ø± Ûµ Ù…Ú¯Ø§Ø¨Ø§ÛŒØª - ÙØ±Ù…Øª: JPG, PNG, WebP</div>
          </div>

          <!-- Laptop Specifications -->
          <div id="laptopSpecs" class="d-none">
            <hr class="my-4" />
            <h6 class="mb-3">ğŸ“± Ù…Ø´Ø®ØµØ§Øª Ù„Ù¾â€ŒØªØ§Ù¾</h6>
            
            <div class="mb-3">
              <label class="form-label">Ù†ÙˆØ±Ù¾Ø±Ø¯Ø§Ø²ÛŒ ØµÙØ­Ù‡ Ú©Ù„ÛŒØ¯</label>
              <input type="text" id="laptop_keyboard_light" class="form-control" placeholder="Ù…Ø«Ø§Ù„: ØªÚ© Ø±Ù†Ú¯" />
            </div>

            <div class="mb-3">
              <label class="form-label">Ø³Ø§Ø²Ù†Ø¯Ù‡ Ù¾Ø±Ø¯Ø§Ø²Ù†Ø¯Ù‡ Ú¯Ø±Ø§ÙÛŒÚ©ÛŒ</label>
              <input type="text" id="laptop_gpu" class="form-control" placeholder="Ù…Ø«Ø§Ù„: NVIDIA" />
            </div>

            <div class="mb-3">
              <label class="form-label">Ø¸Ø±ÙÛŒØª Ø­Ø§ÙØ¸Ù‡ Ø±Ù… (RAM)</label>
              <input type="text" id="laptop_ram" class="form-control" placeholder="Ù…Ø«Ø§Ù„: 16 Ú¯ÛŒÚ¯Ø§Ø¨Ø§ÛŒØª" />
            </div>

            <div class="mb-3">
              <label class="form-label">Ù†Ø³Ù„ Ù¾Ø±Ø¯Ø§Ø²Ù†Ø¯Ù‡</label>
              <input type="text" id="laptop_processor" class="form-control" placeholder="Ù…Ø«Ø§Ù„: Ù†Ø³Ù„ 13 Ø§ÛŒÙ†ØªÙ„" />
            </div>

            <div class="mb-3">
              <label class="form-label">Ø¯Ù‚Øª ØµÙØ­Ù‡ Ù†Ù…Ø§ÛŒØ´</label>
              <input type="text" id="laptop_resolution" class="form-control" placeholder="Ù…Ø«Ø§Ù„: Full HD | 1920 x1080 Ù¾ÛŒÚ©Ø³Ù„" />
            </div>

            <div class="mb-3">
              <label class="form-label">Ø¸Ø±ÙÛŒØª Ø­Ø§ÙØ¸Ù‡ Ø¯Ø§Ø®Ù„ÛŒ</label>
              <input type="text" id="laptop_storage" class="form-control" placeholder="Ù…Ø«Ø§Ù„: 512 Ú¯ÛŒÚ¯Ø§Ø¨Ø§ÛŒØª" />
            </div>

            <div class="mb-3">
              <label class="form-label">Ù†Ø±Ø® Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØµÙˆÛŒØ±</label>
              <input type="text" id="laptop_refresh_rate" class="form-control" placeholder="Ù…Ø«Ø§Ù„: 144 Ù‡Ø±ØªØ²" />
            </div>

            <div class="mb-3">
              <label class="form-label">Ú©Ø§Ø±Ø¨Ø±ÛŒ</label>
              <input type="text" id="laptop_usage" class="form-control" placeholder="Ù…Ø«Ø§Ù„: Ú¯ÛŒÙ…ÛŒÙ†Ú¯" />
            </div>

            <div class="mb-3">
              <label class="form-label">Ù†ÙˆØ¹ Ø±ÙˆÚ©Ø´ ØµÙØ­Ù‡â€ŒÙ†Ù…Ø§ÛŒØ´</label>
              <input type="text" id="laptop_screen_type" class="form-control" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø§Øª" />
            </div>
          </div>

          <!-- Mobile Phone Specifications -->
          <div id="mobileSpecs" class="d-none">
            <hr class="my-4" />
            <h6 class="mb-3">ğŸ“± Ù…Ø´Ø®ØµØ§Øª Ù…ÙˆØ¨Ø§ÛŒÙ„</h6>

            <div class="mb-3">
              <label class="form-label">Ø±ÛŒØ¬Ù†</label>
              <input type="text" id="mobile_region" class="form-control" placeholder="Ù…Ø«Ø§Ù„: ÙˆÛŒØªÙ†Ø§Ù…" />
            </div>

            <div class="mb-3">
              <label class="form-label">Ù†ÙˆØ¹ Ú¯ÙˆØ´ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„</label>
              <input type="text" id="mobile_type" class="form-control" placeholder="Ù…Ø«Ø§Ù„: Ø³ÛŒØ³ØªÙ… Ø¹Ø§Ù…Ù„ Ø§Ù†Ø¯Ø±ÙˆÛŒØ¯" />
            </div>

            <div class="mb-3">
              <label class="form-label">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</label>
              <input type="text" id="mobile_class" class="form-control" placeholder="Ù…Ø«Ø§Ù„: Ù¾Ø±Ú†Ù…â€ŒØ¯Ø§Ø±" />
            </div>

            <div class="mb-3">
              <label class="form-label">Ù…Ø¯Ù„</label>
              <input type="text" id="mobile_model" class="form-control" placeholder="Ù…Ø«Ø§Ù„: Galaxy SÛ²Ûµ Ultra" />
            </div>

            <div class="mb-3">
              <label class="form-label">Ø²Ù…Ø§Ù† Ù…Ø¹Ø±ÙÛŒ</label>
              <input type="text" id="mobile_launch_date" class="form-control" placeholder="Ù…Ø«Ø§Ù„: Û²Û² Ú˜Ø§Ù†ÙˆÛŒÙ‡ Û²Û°Û²Ûµ" />
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ù„ØºÙˆ</button>
          <button type="submit" class="btn btn-primary">Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„</button>
        </div>
      </form>
    </div>
  </div>
</div>

  <script>
   // Initialize Modal and Button Handler
const addModal = new bootstrap.Modal('#addProductModal');
document.getElementById('openAddProduct').onclick = () => addModal.show();

document.getElementById('addProductForm').onsubmit = async (e) => {
  e.preventDefault();
  
  // Validate required fields
  const name = document.getElementById('p_name').value.trim();
  const category = document.getElementById('p_category').value.trim();
  const priceInput = document.getElementById('p_price').value;
  
  if (!name || !category || !priceInput) {
    showAlert('Ù†Ø§Ù…ØŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ùˆ Ù‚ÛŒÙ…Øª Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª!', 'danger');
    return;
  }
  
  const price = parseFloat(priceInput);
  if (isNaN(price) || price <= 0) {
    showAlert('Ù‚ÛŒÙ…Øª Ø¨Ø§ÛŒØ¯ ÛŒÚ© Ø¹Ø¯Ø¯ Ù…Ø«Ø¨Øª Ø¨Ø§Ø´Ø¯!', 'danger');
    return;
  }
  
  const formData = new FormData();
  formData.append('name', name);
  formData.append('description', document.getElementById('p_description').value.trim());
  formData.append('price', price);
  const stockValue = document.getElementById('p_stock').value;
  formData.append('stock', stockValue ? parseInt(stockValue) : 1);
  formData.append('category', category);
  
  // Add specifications based on category
  const specs = {};
  
  if (category === 'laptop') {
    specs.keyboard_light = document.getElementById('laptop_keyboard_light').value.trim();
    specs.gpu = document.getElementById('laptop_gpu').value.trim();
    specs.ram = document.getElementById('laptop_ram').value.trim();
    specs.processor = document.getElementById('laptop_processor').value.trim();
    specs.resolution = document.getElementById('laptop_resolution').value.trim();
    specs.storage = document.getElementById('laptop_storage').value.trim();
    specs.refresh_rate = document.getElementById('laptop_refresh_rate').value.trim();
    specs.usage = document.getElementById('laptop_usage').value.trim();
    specs.screen_type = document.getElementById('laptop_screen_type').value.trim();
  } else if (category === 'mobile') {
    specs.region = document.getElementById('mobile_region').value.trim();
    specs.type = document.getElementById('mobile_type').value.trim();
    specs.class = document.getElementById('mobile_class').value.trim();
    specs.model = document.getElementById('mobile_model').value.trim();
    specs.launch_date = document.getElementById('mobile_launch_date').value.trim();
  }
  
  formData.append('specifications', JSON.stringify(specs));
  
  const fileInput = document.getElementById('p_image');
  if (fileInput.files[0]) formData.append('image', fileInput.files[0]);

  try {
    const authToken = localStorage.getItem('token');
    if (!authToken) {
      showAlert('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø³ÛŒØ³ØªÙ… Ø´ÙˆÛŒØ¯', 'danger');
      return;
    }

    const res = await fetch('/api/admin/products', {
      method: 'POST',
      headers: { 'Authorization': 'Bearer ' + authToken },
      body: formData
    });

    const data = await res.json();
    console.log('Response:', res.status, data);
    
    if (res.ok) {
      addModal.hide();
      document.getElementById('addProductForm').reset();
      document.getElementById('laptopSpecs').classList.add('d-none');
      document.getElementById('mobileSpecs').classList.add('d-none');
      showAlert('Ù…Ø­ØµÙˆÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯!', 'success');
      loadAdminDashboard();
    } else {
      const errorMsg = data.message || data.error || 'Ø®Ø·Ø§ Ø¯Ø± Ø§ÙØ²ÙˆØ¯Ù†';
      console.error('Error details:', errorMsg);
      showAlert(errorMsg, 'danger');
    }
  } catch (error) {
    console.error('Error:', error);
    showAlert('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„: ' + error.message, 'danger');
  }
};

// ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´/Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† Ù…Ø´Ø®ØµØ§Øª Ø¨Ø±Ø§Ø³Ø§Ø³ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
function updateSpecifications() {
  const category = document.getElementById('p_category').value;
  const laptopSpecs = document.getElementById('laptopSpecs');
  const mobileSpecs = document.getElementById('mobileSpecs');
  
  if (category === 'laptop') {
    laptopSpecs.classList.remove('d-none');
    mobileSpecs.classList.add('d-none');
  } else if (category === 'mobile') {
    laptopSpecs.classList.add('d-none');
    mobileSpecs.classList.remove('d-none');
  } else {
    laptopSpecs.classList.add('d-none');
    mobileSpecs.classList.add('d-none');
  }
}

  </script>

  <!-- ØµÙØ­Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª Ù…Ø­ØµÙˆÙ„ (Ù…Ø´ØªØ±ÛŒ) -->
<div id="productDetailView" class="d-none">
  <div class="container py-5">
    <div class="product-detail-card">
      <div class="row g-4 align-items-center">
        <div class="col-lg-6">
          <img id="detailImage" class="product-detail-img" alt="Ù…Ø­ØµÙˆÙ„" />
        </div>
        <div class="col-lg-6 product-detail-info">
          <h2 id="detailName"></h2>
          <p class="product-detail-category" id="detailCategory"></p>
          <p id="detailDescription" class="product-detail-description"></p>
          <div class="product-detail-price-section">
            <div>
              <div class="small text-muted mb-2">Ù‚ÛŒÙ…Øª</div>
              <div class="product-detail-price" id="detailPrice"></div>
            </div>
            <div>
              <span class="product-detail-stock" id="detailStock"></span>
            </div>
          </div>
          <div class="product-detail-buttons">
            <button class="btn btn-primary" id="addToCartBtn">
              <i class="bi bi-bag-plus"></i> Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯
            </button>
            <button class="btn btn-outline-secondary" onclick="document.getElementById('productDetailView').classList.add('d-none'); document.getElementById('customerView').classList.remove('d-none');">
              <i class="bi bi-arrow-right"></i> Ø¨Ø§Ø²Ú¯Ø´Øª
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Cart Page View -->
<div id="cartView" class="d-none">
  <div class="container py-4">
    <div class="cart-page-container">
      <div class="cart-page-header">
        <h2>ğŸ›’ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</h2>
        <button class="btn btn-outline-secondary" onclick="document.getElementById('cartView').classList.add('d-none'); document.getElementById('customerView').classList.remove('d-none');">
          <i class="bi bi-arrow-right"></i> Ø¨Ø§Ø²Ú¯Ø´Øª
        </button>
      </div>

      <div id="cartEmptyState" class="cart-empty-message">
        <div class="cart-empty-icon">ğŸ“­</div>
        <div class="cart-empty-text">Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø´Ù…Ø§ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª</div>
        <button class="btn btn-primary" onclick="document.getElementById('cartView').classList.add('d-none'); document.getElementById('customerView').classList.remove('d-none');">
          Ø¨Ø±Ùˆ Ø¨Ù‡ Ø®Ø±ÛŒØ¯
        </button>
      </div>

      <div id="cartFullState" class="d-none">
        <div class="table-responsive mb-4">
          <table class="cart-items-table">
            <thead>
              <tr>
                <th>Ù…Ø­ØµÙˆÙ„</th>
                <th>Ù‚ÛŒÙ…Øª ÙˆØ§Ø­Ø¯</th>
                <th>ØªØ¹Ø¯Ø§Ø¯</th>
                <th>Ù…Ø¬Ù…ÙˆØ¹</th>
                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
              </tr>
            </thead>
            <tbody id="cartTableBody">
            </tbody>
          </table>
        </div>

        <div class="cart-summary-section">
          <div class="cart-summary-row">
            <span>Ø¬Ù…Ø¹ Ú©Ù„ Ù…Ø­ØµÙˆÙ„Ø§Øª:</span>
            <span id="cartSubtotal">Û° ØªÙˆÙ…Ø§Ù†</span>
          </div>
          <div class="cart-summary-row total">
            <span>Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª:</span>
            <span id="cartFinalTotal">Û° ØªÙˆÙ…Ø§Ù†</span>
          </div>
        </div>

        <!-- Order Form -->
        <div class="order-form-section">
          <h4 class="order-form-title">ğŸ“‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÙØ§Ø±Ø´</h4>
          <form id="orderForm" class="order-form">
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="shippingAddress" class="form-label">Ø¢Ø¯Ø±Ø³ ØªØ­ÙˆÛŒÙ„ *</label>
                  <textarea
                    class="form-control"
                    id="shippingAddress"
                    rows="3"
                    placeholder="Ø¢Ø¯Ø±Ø³ Ú©Ø§Ù…Ù„ ØªØ­ÙˆÛŒÙ„ Ø³ÙØ§Ø±Ø´ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..."
                    required
                  ></textarea>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="paymentMethod" class="form-label">Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª *</label>
                  <select class="form-select" id="paymentMethod" required>
                    <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option>
                    <option value="cash">Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ù‚Ø¯ÛŒ Ù‡Ù†Ú¯Ø§Ù… ØªØ­ÙˆÛŒÙ„</option>
                    <option value="card">Ú©Ø§Ø±Øª Ø¨Ù‡ Ú©Ø§Ø±Øª</option>
                    <option value="online">Ù¾Ø±Ø¯Ø§Ø®Øª Ø¢Ù†Ù„Ø§ÛŒÙ†</option>
                  </select>
                </div>
                <div class="mb-3">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="termsCheck" required>
                    <label class="form-check-label" for="termsCheck">
                      Ø´Ø±Ø§ÛŒØ· Ùˆ Ù‚ÙˆØ§Ù†ÛŒÙ† ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø±Ø§ Ù…ÛŒâ€ŒÙ¾Ø°ÛŒØ±Ù…
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>

        <div class="cart-actions">
          <button class="btn btn-outline-secondary" onclick="document.getElementById('cartView').classList.add('d-none'); document.getElementById('customerView').classList.remove('d-none');">
            <i class="bi bi-arrow-right"></i> Ø§Ø¯Ø§Ù…Ù‡ Ø®Ø±ÛŒØ¯
          </button>
          <button class="btn btn-success" id="cartCheckoutBtn">
            <i class="bi bi-check-circle"></i> ØªØ£ÛŒÛŒØ¯ Ùˆ Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Ù†Ù…Ø§ÛŒØ´ Ø¬Ø²Ø¦ÛŒØ§Øª Ù…Ø­ØµÙˆÙ„
async function showProductDetail(id) {
  customerView.classList.add('d-none');
  document.getElementById('productDetailView').classList.remove('d-none');
  const res = await api(`/api/products/${id}`);
  if (!res.ok) return showAlert('Ù…Ø­ØµÙˆÙ„ ÛŒØ§ÙØª Ù†Ø´Ø¯', 'danger');

  const p = res.data;
  document.getElementById('detailImage').src = p.image_url || 'https://via.placeholder.com/500';
  document.getElementById('detailName').innerText = p.name;
  document.getElementById('detailCategory').innerText = p.category || 'Ø¨Ø¯ÙˆÙ† Ø¯Ø³ØªÙ‡';
  document.getElementById('detailDescription').innerText = p.description || 'ØªÙˆØ¶ÛŒØ­Ø§ØªÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª.';
  document.getElementById('detailPrice').innerText = Number(p.price).toLocaleString() + ' ØªÙˆÙ…Ø§Ù†';
  document.getElementById('detailStock').className = p.stock > 0 ? 'badge bg-success' : 'badge bg-danger';
  document.getElementById('detailStock').innerText = p.stock > 0 ? `${p.stock} Ø¹Ø¯Ø¯ Ù…ÙˆØ¬ÙˆØ¯` : 'Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯';

  document.getElementById('addToCartBtn').onclick = () => {
    addToCart(p.id, p.name, p.price, p.image_url || 'https://via.placeholder.com/300');
    showAlert('Ø¨Ù‡ Ø³Ø¨Ø¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯!', 'success');
    updateCart();
  };
}

// Cart Page Functions
function showCartPage() {
  customerView.classList.add('d-none');
  document.getElementById('productDetailView').classList.add('d-none');
  document.getElementById('cartView').classList.remove('d-none');
  renderCartPage();
}

function renderCartPage() {
  const cartEmptyState = document.getElementById('cartEmptyState');
  const cartFullState = document.getElementById('cartFullState');
  
  if (cart.length === 0) {
    cartEmptyState.classList.remove('d-none');
    cartFullState.classList.add('d-none');
    return;
  }
  
  cartEmptyState.classList.add('d-none');
  cartFullState.classList.remove('d-none');
  
  const tableBody = document.getElementById('cartTableBody');
  tableBody.innerHTML = '';
  
  let subtotal = 0;
  
  cart.forEach((item, idx) => {
    const itemTotal = item.price * item.qty;
    subtotal += itemTotal;
    
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>
        <div class="cart-product-info">
          <img src="${item.img}" class="cart-product-img" alt="${item.name}">
          <div>
            <div class="cart-product-name">${item.name}</div>
            <div class="cart-product-category">ID: ${item.id}</div>
          </div>
        </div>
      </td>
      <td>
        <div class="cart-price">${Number(item.price).toLocaleString()} ØªÙˆÙ…Ø§Ù†</div>
      </td>
      <td>
        <div class="cart-qty-control">
          <button class="cart-qty-btn" onclick="decreaseQty(${idx})">âˆ’</button>
          <input type="number" class="cart-qty-input" value="${item.qty}" min="1" onchange="updateQty(${idx}, this.value)">
          <button class="cart-qty-btn" onclick="increaseQty(${idx})">+</button>
        </div>
      </td>
      <td>
        <div class="cart-price">${Number(itemTotal).toLocaleString()} ØªÙˆÙ…Ø§Ù†</div>
      </td>
      <td>
        <button class="cart-btn-remove" onclick="removeFromCart(${idx})">
          <i class="bi bi-trash"></i> Ø­Ø°Ù
        </button>
      </td>
    `;
    tableBody.appendChild(row);
  });
  
  document.getElementById('cartSubtotal').innerText = Number(subtotal).toLocaleString() + ' ØªÙˆÙ…Ø§Ù†';
  document.getElementById('cartFinalTotal').innerText = Number(subtotal).toLocaleString() + ' ØªÙˆÙ…Ø§Ù†';
}

function increaseQty(idx) {
  if (cart[idx]) {
    cart[idx].qty = parseInt(cart[idx].qty) + 1;
    localStorage.setItem('cart', JSON.stringify(cart));
    renderCartPage();
    updateCart();
  }
}

function decreaseQty(idx) {
  if (cart[idx] && cart[idx].qty > 1) {
    cart[idx].qty = parseInt(cart[idx].qty) - 1;
    localStorage.setItem('cart', JSON.stringify(cart));
    renderCartPage();
    updateCart();
  }
}

function updateQty(idx, newQty) {
  const qty = parseInt(newQty);
  if (cart[idx] && qty > 0) {
    cart[idx].qty = qty;
    localStorage.setItem('cart', JSON.stringify(cart));
    renderCartPage();
    updateCart();
  }
}

function removeFromCart(idx) {
  if (confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) {
    cart.splice(idx, 1);
    localStorage.setItem('cart', JSON.stringify(cart));
    renderCartPage();
    updateCart();
    showAlert('Ù…Ø­ØµÙˆÙ„ Ø­Ø°Ù Ø´Ø¯', 'info');
  }
}

// Cart Page Checkout
document.getElementById('cartCheckoutBtn').onclick = async () => {
  if (cart.length === 0) return;
  
  // Check if user is authenticated
  if (!token || role === 'guest') {
    showAlert('Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ø¨Ø§ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯ ÛŒØ§ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ù†ÛŒØ¯', 'warning');
    setTimeout(() => location.href = 'login.html', 1500);
    return;
  }

  // Get form data
  const shippingAddress = document.getElementById('shippingAddress').value.trim();
  const paymentMethod = document.getElementById('paymentMethod').value;
  const termsCheck = document.getElementById('termsCheck').checked;

  if (!shippingAddress) {
    showAlert('Ø¢Ø¯Ø±Ø³ ØªØ­ÙˆÛŒÙ„ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'warning');
    return;
  }

  if (!paymentMethod) {
    showAlert('Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'warning');
    return;
  }

  if (!termsCheck) {
    showAlert('Ø´Ø±Ø§ÛŒØ· Ùˆ Ù‚ÙˆØ§Ù†ÛŒÙ† Ø±Ø§ Ø¨Ù¾Ø°ÛŒØ±ÛŒØ¯', 'warning');
    return;
  }
  
  const res = await api('/api/orders', {
    method: 'POST',
    body: JSON.stringify({
      items: cart,
      shipping_address: shippingAddress,
      payment_method: paymentMethod
    })
  });

  if (res.ok) {
    const orderId = res.data.orderId;
    cart = [];
    localStorage.removeItem('cart');
    showAlert(`Ø³ÙØ§Ø±Ø´ #${orderId} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯!`, 'success');
    updateCart();
    
    // Clear form
    document.getElementById('orderForm').reset();
    
    setTimeout(() => {
      document.getElementById('cartView').classList.add('d-none');
      document.getElementById('customerView').classList.remove('d-none');
      loadCustomerProducts();
    }, 2000);
  } else {
    showAlert(res.data?.message || 'Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´', 'danger');
  }
};

// Add Cart Navigation
document.getElementById('navCart').onclick = (e) => {
  e.preventDefault();
  showCartPage();
};
</script>

</body>
</html>